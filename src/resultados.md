1. 📋 VERIFICAR RPCs EXISTENTES:
| routine_name                                     | routine_type | data_type                | routine_definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------ | ------------ | ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get_auth                                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_bit                                          | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_bit                                          | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_byte                                         | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_current_ts_config                            | FUNCTION     | regconfig                | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_ranking                                      | FUNCTION     | record                   | 
  select gs.user_id,
         u.username,
         u.email,
         u.created_at,
         gs.total_coins::numeric,
         gs.total_clicks,
         gs.level,
         gs.prestige_level,
         coalesce(gs.max_streak, gs.streak) as streak,
         (
           coalesce(gs.total_coins,0)
           + (coalesce(gs.level,0) * 1000)
           + (coalesce(gs.total_clicks,0) * 2)
           + (coalesce(gs.max_streak, gs.streak, 0) * 500)
           + (coalesce(gs.prestige_level,0) * 5000)
         )::numeric as overall_score
  from public.game_stats gs
  join public.users u on u.id = gs.user_id
  order by overall_score desc
  limit coalesce(p_limit, 100);
 |
| get_schema_version                               | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| get_size_by_bucket                               | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| getdatabaseencoding                              | FUNCTION     | name                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| getpgusername                                    | FUNCTION     | name                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| namegetext                                       | FUNCTION     | boolean                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_backend_memory_contexts                   | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_catalog_foreign_keys                      | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_constraintdef                             | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_constraintdef                             | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_expr                                      | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_expr                                      | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_function_arg_default                      | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_function_arguments                        | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_function_identity_arguments               | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_function_result                           | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_function_sqlbody                          | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_functiondef                               | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_indexdef                                  | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_indexdef                                  | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_keywords                                  | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_multixact_members                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_object_address                            | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_partition_constraintdef                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_partkeydef                                | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_publication_tables                        | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_replica_identity_index                    | FUNCTION     | regclass                 | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_replication_slots                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_ruledef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_ruledef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_serial_sequence                           | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_shmem_allocations                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_statisticsobjdef                          | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_statisticsobjdef_columns                  | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_statisticsobjdef_expressions              | FUNCTION     | ARRAY                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_triggerdef                                | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_triggerdef                                | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_userbyid                                  | FUNCTION     | name                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_viewdef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_viewdef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_viewdef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_viewdef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_viewdef                                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_wait_events                               | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_wal_replay_pause_state                    | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_wal_resource_managers                     | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_get_wal_summarizer_state                      | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_logical_slot_get_binary_changes               | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_logical_slot_get_changes                      | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_settings_get_flags                            | FUNCTION     | ARRAY                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_activity                             | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_analyze_count                        | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_archiver                             | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_autoanalyze_count                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_autovacuum_count                     | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_activity                     | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_activity_start               | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_client_addr                  | FUNCTION     | inet                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_client_port                  | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_dbid                         | FUNCTION     | oid                      | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_idset                        | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_pid                          | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_start                        | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_subxact                      | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_userid                       | FUNCTION     | oid                      | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_wait_event                   | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_wait_event_type              | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_backend_xact_start                   | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_bgwriter_buf_written_clean           | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_bgwriter_maxwritten_clean            | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_bgwriter_stat_reset_time             | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_blocks_fetched                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_blocks_hit                           | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_buf_alloc                            | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_buffers_written         | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_num_requested           | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_num_timed               | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_restartpoints_performed | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_restartpoints_requested | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_restartpoints_timed     | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_stat_reset_time         | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_sync_time               | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_checkpointer_write_time              | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_active_time                       | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_blk_read_time                     | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_blk_write_time                    | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_blocks_fetched                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_blocks_hit                        | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_checksum_failures                 | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_checksum_last_failure             | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_all                      | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_bufferpin                | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_lock                     | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_logicalslot              | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_snapshot                 | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_startup_deadlock         | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_conflict_tablespace               | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_deadlocks                         | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_idle_in_transaction_time          | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_numbackends                       | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_session_time                      | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_sessions                          | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_sessions_abandoned                | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_sessions_fatal                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_sessions_killed                   | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_stat_reset_time                   | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_temp_bytes                        | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_temp_files                        | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_tuples_deleted                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_tuples_fetched                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_tuples_inserted                   | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_tuples_returned                   | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_tuples_updated                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_xact_commit                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_db_xact_rollback                     | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_dead_tuples                          | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_function_calls                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_function_self_time                   | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_function_total_time                  | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_ins_since_vacuum                     | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_io                                   | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_last_analyze_time                    | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_last_autoanalyze_time                | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_last_autovacuum_time                 | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_last_vacuum_time                     | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_lastscan                             | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_live_tuples                          | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_mod_since_analyze                    | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_numscans                             | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_progress_info                        | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_recovery_prefetch                    | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_replication_slot                     | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_slru                                 | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_snapshot_timestamp                   | FUNCTION     | timestamp with time zone | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_subscription                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_subscription_stats                   | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_deleted                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_fetched                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_hot_updated                   | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_inserted                      | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_newpage_updated               | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_returned                      | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_tuples_updated                       | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_vacuum_count                         | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_wal                                  | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_wal_receiver                         | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_wal_senders                          | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_blocks_fetched                  | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_blocks_hit                      | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_function_calls                  | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_function_self_time              | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_function_total_time             | FUNCTION     | double precision         | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_numscans                        | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_deleted                  | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_fetched                  | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_hot_updated              | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_inserted                 | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_newpage_updated          | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_returned                 | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| pg_stat_get_xact_tuples_updated                  | FUNCTION     | bigint                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| refresh_ranking                                  | FUNCTION     | void                     | 
BEGIN
    REFRESH MATERIALIZED VIEW public.ranking_view;
END;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| save_game_state                                  | FUNCTION     | void                     | 
  insert into public.game_stats (user_id, total_coins, upgrades, prestige_level, last_sync)
  values (auth.uid(), p_coins, p_upgrades, p_prestige_level, now())
  on conflict (user_id) do update set
    total_coins    = excluded.total_coins,
    upgrades       = excluded.upgrades,
    prestige_level = greatest(public.game_stats.prestige_level, excluded.prestige_level),
    last_sync      = now();
                                                                                                                                                                                                                                                                                        |














2. 🔧 VERIFICAR ESTRUTURA DAS TABELAS:
| table_name    | column_name        | data_type                | is_nullable | column_default    |
| ------------- | ------------------ | ------------------------ | ----------- | ----------------- |
| game_stats    | id                 | uuid                     | NO          | gen_random_uuid() |
| game_stats    | user_id            | uuid                     | YES         | null              |
| game_stats    | total_coins        | numeric                  | YES         | 0                 |
| game_stats    | total_clicks       | integer                  | YES         | 0                 |
| game_stats    | level              | integer                  | YES         | 1                 |
| game_stats    | experience         | integer                  | YES         | 0                 |
| game_stats    | prestige_level     | integer                  | YES         | 0                 |
| game_stats    | streak             | integer                  | YES         | 0                 |
| game_stats    | last_click         | timestamp with time zone | YES         | now()             |
| game_stats    | last_sync          | timestamp with time zone | YES         | now()             |
| game_stats    | created_at         | timestamp with time zone | YES         | now()             |
| game_stats    | updated_at         | timestamp with time zone | YES         | now()             |
| game_stats    | max_streak         | integer                  | YES         | 0                 |
| game_stats    | total_achievements | integer                  | YES         | 0                 |
| game_stats    | referrals          | jsonb                    | YES         | '[]'::jsonb       |
| game_stats    | achievements       | jsonb                    | YES         | '[]'::jsonb       |
| game_stats    | rewards            | jsonb                    | YES         | '{}'::jsonb       |
| game_stats    | missions           | jsonb                    | YES         | '{}'::jsonb       |
| game_stats    | customization      | jsonb                    | YES         | '{}'::jsonb       |
| game_stats    | days_active        | jsonb                    | YES         | '[]'::jsonb       |
| game_stats    | airdrop_points     | bigint                   | YES         | 0                 |
| game_stats    | upgrades           | jsonb                    | YES         | '{}'::jsonb       |
| user_upgrades | id                 | uuid                     | NO          | gen_random_uuid() |
| user_upgrades | user_id            | uuid                     | YES         | null              |
| user_upgrades | upgrade_type       | character varying        | NO          | null              |
| user_upgrades | level              | integer                  | YES         | 1                 |
| user_upgrades | cost               | numeric                  | YES         | 0                 |
| user_upgrades | value              | numeric                  | YES         | 0                 |
| user_upgrades | created_at         | timestamp with time zone | YES         | now()             |
| user_upgrades | updated_at         | timestamp with time zone | YES         | now()             |
| users         | id                 | uuid                     | NO          | gen_random_uuid() |
| users         | username           | character varying        | NO          | null              |
| users         | email              | character varying        | NO          | null              |
| users         | wallet_address     | character varying        | YES         | null              |
| users         | created_at         | timestamp with time zone | YES         | now()             |
| users         | updated_at         | timestamp with time zone | YES         | now()             |
| users         | avatar_url         | text                     | YES         | null              |
| users         | referral_id        | character varying        | YES         | null              |
| users         | referred_by        | character varying        | YES         | null              |
| users         | display_name       | character varying        | YES         | null              |


3. ��️ VERIFICAR POLÍTICAS RLS:
| schemaname | tablename     | policyname                             | permissive | roles    | cmd    | qual                   | with_check             |
| ---------- | ------------- | -------------------------------------- | ---------- | -------- | ------ | ---------------------- | ---------------------- |
| public     | game_stats    | Enable all operations for game_stats   | PERMISSIVE | {public} | ALL    | true                   | true                   |
| public     | game_stats    | Users can update own game stats        | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                   |
| public     | game_stats    | Users can view all stats               | PERMISSIVE | {public} | SELECT | true                   | null                   |
| public     | game_stats    | Users can view own game stats          | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                   |
| public     | game_stats    | game_stats_insert_own                  | PERMISSIVE | {public} | INSERT | null                   | (user_id = auth.uid()) |
| public     | game_stats    | game_stats_select_own                  | PERMISSIVE | {public} | SELECT | (user_id = auth.uid()) | null                   |
| public     | game_stats    | game_stats_update_own                  | PERMISSIVE | {public} | UPDATE | (user_id = auth.uid()) | null                   |
| public     | user_upgrades | User upgrades are viewable by everyone | PERMISSIVE | {public} | SELECT | true                   | null                   |
| public     | user_upgrades | Users can insert own upgrades          | PERMISSIVE | {public} | INSERT | null                   | (auth.uid() = user_id) |
| public     | user_upgrades | Users can update own upgrades          | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                   |
| public     | user_upgrades | Users can view all upgrades            | PERMISSIVE | {public} | SELECT | true                   | null                   |
| public     | user_upgrades | Users can view own upgrades            | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                   |
| public     | user_upgrades | user_upgrades_select_own               | PERMISSIVE | {public} | SELECT | (user_id = auth.uid()) | null                   |
| public     | user_upgrades | user_upgrades_upsert_own               | PERMISSIVE | {public} | ALL    | (user_id = auth.uid()) | (user_id = auth.uid()) |
| public     | users         | Enable all operations for users        | PERMISSIVE | {public} | ALL    | true                   | true                   |
| public     | users         | Enable insert for authenticated users  | PERMISSIVE | {public} | INSERT | null                   | true                   |
| public     | users         | Users can update own profile           | PERMISSIVE | {public} | UPDATE | (auth.uid() = id)      | null                   |
| public     | users         | Users can view own profile             | PERMISSIVE | {public} | SELECT | (auth.uid() = id)      | null                   |



4. 📊 VERIFICAR DADOS NAS TABELAS:
| tabela        | total |
| ------------- | ----- |
| users         | 5     |
| game_stats    | 5     |
| user_upgrades | 4     |



5. �� VERIFICAR ÍNDICES:
| schemaname | tablename     | indexname                              | indexdef                                                                                                               |
| ---------- | ------------- | -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| public     | game_stats    | game_stats_achievements_gin            | CREATE INDEX game_stats_achievements_gin ON public.game_stats USING gin (achievements)                                 |
| public     | game_stats    | game_stats_days_active_gin             | CREATE INDEX game_stats_days_active_gin ON public.game_stats USING gin (days_active)                                   |
| public     | game_stats    | game_stats_pkey                        | CREATE UNIQUE INDEX game_stats_pkey ON public.game_stats USING btree (id)                                              |
| public     | game_stats    | game_stats_upgrades_gin                | CREATE INDEX game_stats_upgrades_gin ON public.game_stats USING gin (upgrades)                                         |
| public     | game_stats    | game_stats_user_id_key                 | CREATE UNIQUE INDEX game_stats_user_id_key ON public.game_stats USING btree (user_id)                                  |
| public     | game_stats    | game_stats_user_unique                 | CREATE UNIQUE INDEX game_stats_user_unique ON public.game_stats USING btree (user_id)                                  |
| public     | game_stats    | idx_game_stats_level                   | CREATE INDEX idx_game_stats_level ON public.game_stats USING btree (level)                                             |
| public     | game_stats    | idx_game_stats_referrals               | CREATE INDEX idx_game_stats_referrals ON public.game_stats USING gin (referrals)                                       |
| public     | game_stats    | idx_game_stats_total_coins             | CREATE INDEX idx_game_stats_total_coins ON public.game_stats USING btree (total_coins DESC)                            |
| public     | game_stats    | idx_game_stats_user_id                 | CREATE INDEX idx_game_stats_user_id ON public.game_stats USING btree (user_id)                                         |
| public     | user_upgrades | idx_user_upgrades_user_id              | CREATE INDEX idx_user_upgrades_user_id ON public.user_upgrades USING btree (user_id)                                   |
| public     | user_upgrades | user_upgrades_pkey                     | CREATE UNIQUE INDEX user_upgrades_pkey ON public.user_upgrades USING btree (id)                                        |
| public     | user_upgrades | user_upgrades_user_id_upgrade_type_key | CREATE UNIQUE INDEX user_upgrades_user_id_upgrade_type_key ON public.user_upgrades USING btree (user_id, upgrade_type) |
| public     | user_upgrades | user_upgrades_user_type_uniq           | CREATE UNIQUE INDEX user_upgrades_user_type_uniq ON public.user_upgrades USING btree (user_id, upgrade_type)           |
| public     | users         | idx_users_email                        | CREATE INDEX idx_users_email ON public.users USING btree (email)                                                       |
| public     | users         | idx_users_referral_id                  | CREATE INDEX idx_users_referral_id ON public.users USING btree (referral_id)                                           |
| public     | users         | idx_users_referred_by                  | CREATE INDEX idx_users_referred_by ON public.users USING btree (referred_by)                                           |
| public     | users         | idx_users_username                     | CREATE INDEX idx_users_username ON public.users USING btree (username)                                                 |
| public     | users         | idx_users_wallet                       | CREATE INDEX idx_users_wallet ON public.users USING btree (wallet_address)                                             |
| public     | users         | users_email_key                        | CREATE UNIQUE INDEX users_email_key ON public.users USING btree (email)                                                |
| public     | users         | users_pkey                             | CREATE UNIQUE INDEX users_pkey ON public.users USING btree (id)                                                        |
| public     | users         | users_referral_id_key                  | CREATE UNIQUE INDEX users_referral_id_key ON public.users USING btree (referral_id)                                    |
| public     | users         | users_username_key                     | CREATE UNIQUE INDEX users_username_key ON public.users USING btree (username)                                          |
| public     | users         | users_wallet_address_key               | CREATE UNIQUE INDEX users_wallet_address_key ON public.users USING btree (wallet_address)                              |

6. ⚠️ VERIFICAR ERROS DE RPC:
| routine_name | routine_definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get_ranking  | 
  select gs.user_id,
         u.username,
         u.email,
         u.created_at,
         gs.total_coins::numeric,
         gs.total_clicks,
         gs.level,
         gs.prestige_level,
         coalesce(gs.max_streak, gs.streak) as streak,
         (
           coalesce(gs.total_coins,0)
           + (coalesce(gs.level,0) * 1000)
           + (coalesce(gs.total_clicks,0) * 2)
           + (coalesce(gs.max_streak, gs.streak, 0) * 500)
           + (coalesce(gs.prestige_level,0) * 5000)
         )::numeric as overall_score
  from public.game_stats gs
  join public.users u on u.id = gs.user_id
  order by overall_score desc
  limit coalesce(p_limit, 100);
 |


 7. 🧪 TESTAR RPC DIRETAMENTE:
 | user_id                              | username | email                      | created_at                    | total_coins | total_clicks | level | prestige_level | streak | overall_score |
| ------------------------------------ | -------- | -------------------------- | ----------------------------- | ----------- | ------------ | ----- | -------------- | ------ | ------------- |
| 1038dbc5-b642-4c3b-b8a5-3b3d590ed3b1 | Letavos  | letavos2@gmail.com         | 2025-09-07 00:17:24.788549+00 | 421.80      | 152          | 1     | 1              | 11     | 12225.80      |
| c5cca478-300d-4a25-8793-84eda4e2d457 | Rei      | reidogamepass2@gmail.com   | 2025-09-08 21:55:40.263453+00 | 16.00       | 16           | 1     | 0              | 0      | 1048.00       |
| 7f6402d6-cc89-409d-b222-983595713058 | TKNutria | tknutria@gmail.com         | 2025-09-07 19:16:34.221924+00 | 0.00        | 0            | 1     | 0              | 0      | 1000.00       |
| 94ae2dff-1e2d-4fad-aebf-3abd0db8754c | Carlos   | reidogamepass3@gmail.com   | 2025-09-08 21:37:17.361986+00 | 0.00        | 0            | 1     | 0              | 0      | 1000.00       |
| d986b242-ab46-4d1e-a15b-3916fe750537 | Nutria   | letavos@colegioequacao.com | 2025-09-07 19:16:34.221924+00 | 0.00        | 0            | 1     | 0              | 0      | 1000.00       |


8. �� VERIFICAR PERMISSÕES:
| routine_name | grantee       | privilege_type |
| ------------ | ------------- | -------------- |
| get_ranking  | postgres      | EXECUTE        |
| get_ranking  | anon          | EXECUTE        |
| get_ranking  | authenticated | EXECUTE        |
| get_ranking  | service_role  | EXECUTE        |



9. 📈 VERIFICAR PERFORMANCE:
| pid    | state  | query_start                   | query                                                                                                                                                                                                                                                                                                  |
| ------ | ------ | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 141586 | active | 2025-09-10 01:59:46.410901+00 | -- Verificar queries ativas (se houver travamento)
SELECT 
    pid,
    state,
    query_start,
    query
FROM pg_stat_activity 
WHERE state = 'active' 
AND query LIKE '%get_ranking%';

-- source: dashboard
-- user: 7f72baf6-e5a6-477f-ad6e-0b3118d210aa
-- date: 2025-09-10T01:59:45.547Z |


10. 🗑️ VERIFICAR LOCKS:
Success. No rows returned


